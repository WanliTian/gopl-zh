## 10.5. 匿名导入

如果只是导入一个包而并不使用导入的包是一个编译错误. 但是有时候我们只是想利用导入包产生的副作用: 它会计算包级变量的初始化表达式和执行导入包的 init 初始化函数 (§2.6.2). 这时候我们需要抑制“未使用的导入”错误是合理的, 我们可以用下划线 `_` 来重命名导入的包. 像往常一样, 下划线 `_` 为空白标识符, 并不能被访问.

```Go
import _ "image/png" // register PNG decoder
```

这个被称为匿名导入. 它通常是用来实现一个编译时机制, 然后通过在main主程序入口选择性地导入附加的包. 首先, 让我们看看如何使用它, 然后再看看它是如何工作的:

标准库的 image 图像包导入了一个 `Decode` 函数, 用于从 `io.Reader` 接口读取数据并解码图像, 它调用底层注册的图像解码器工作, 然后返回 image.Image 类型的图像. 使用 `image.Decode` 很容易编写一个图像格式的转换工具, 读取一种格式的图像, 然后编码为另一种图像格式:

```Go
gopl.io/ch10/jpeg
// The jpeg command reads a PNG image from the standard input
// and writes it as a JPEG image to the standard output.
package main

import (
	"fmt"
	"image"
	"image/jpeg"
	_ "image/png" // register PNG decoder
	"io"
	"os"
)

func main() {
	if err := toJPEG(os.Stdin, os.Stdout); err != nil {
		fmt.Fprintf(os.Stderr, "jpeg: %v\n", err)
		os.Exit(1)
	}
}

func toJPEG(in io.Reader, out io.Writer) error {
	img, kind, err := image.Decode(in)
	if err != nil {
		return err
	}
	fmt.Fprintln(os.Stderr, "Input format =", kind)
	return jpeg.Encode(out, img, &jpeg.Options{Quality: 95})
}
```

如果我们将 `gopl.io/ch3/mandelbrot` (§3.3) 的输出导入到这个工具的输入, 它将解码输入的PNG格式图像, 然后转换为JPEG格式的图像(图3.3).

```
$ go build gopl.io/ch3/mandelbrot
$ go build gopl.io/ch10/jpeg
$ ./mandelbrot | ./jpeg >mandelbrot.jpg
Input format = png
```

要注意 image/png 包的匿名导入语句. 如果没有这一行语句, 依然可以编译和运行, 但是它将不能识别 PNG 格式的图像:

```
$ go build gopl.io/ch10/jpeg
$ ./mandelbrot | ./jpeg >mandelbrot.jpg
jpeg: image: unknown format
```


TODO
